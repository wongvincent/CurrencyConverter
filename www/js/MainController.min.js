angular.module("app").controller("MainController",["$scope","$http","$ionicLoading","$ionicPopup","localStorageService",function(e,n,t,a,s){function o(){e.currenciesModel={};for(var n in e.currencies)e.currenciesModel[n]=null}function l(n,t,a){var s=a/e.exchangeRates[n];return s*e.exchangeRates[t]}function i(e,n){var t=u(e,n);return 0===t?null:t}function u(e,n){return Number(Math.round(e+"e"+n)+"e-"+n)}function r(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth}e.currencies={AUD:{show:!1,fullname:"Australian Dollar"},BRL:{show:!1,fullname:"Brazilian Real"},CAD:{show:!0,fullname:"Canadian Dollar"},CHF:{show:!1,fullname:"Swiss Franc"},CNY:{show:!0,fullname:"Chinese Yuan"},CZK:{show:!1,fullname:"Czech Koruna"},DKK:{show:!1,fullname:"Danish Krone"},EUR:{show:!0,fullname:"Euro"},GBP:{show:!0,fullname:"British Pound"},HKD:{show:!1,fullname:"Hong Kong Dollar"},HRK:{show:!1,fullname:"Croatian Kuna"},HUF:{show:!1,fullname:"Hungarian Forint"},IDR:{show:!1,fullname:"Indonesian Rupiah"},ILS:{show:!1,fullname:"Israeli Shekel"},INR:{show:!1,fullname:"Indian Rupee"},ISK:{show:!1,fullname:"Icelandic Krona"},JPY:{show:!0,fullname:"Japanese Yen"},KRW:{show:!1,fullname:"South Korean Won"},MXN:{show:!1,fullname:"Mexican Peso"},MYR:{show:!1,fullname:"Malaysian Ringgit"},NOK:{show:!1,fullname:"Norwegian Krone"},NZD:{show:!1,fullname:"New Zealand Dollar"},PHP:{show:!1,fullname:"Philippine Peso"},PLN:{show:!1,fullname:"Polish Zloty"},RON:{show:!1,fullname:"Romanian New Leu"},RUB:{show:!1,fullname:"Russian Ruble"},SEK:{show:!1,fullname:"Swedish Krona"},SGD:{show:!1,fullname:"Singapore Dollar"},THB:{show:!1,fullname:"Thai Baht"},TRY:{show:!1,fullname:"Turkish Lira"},USD:{show:!0,fullname:"US Dollar"},ZAR:{show:!1,fullname:"South African Rand"}},e.valueChange=function(n,t){100*n%1!==0&&(e.currenciesModel[t]=((1e3*n).toFixed(0)-(1e3*n).toFixed(0)%10)/1e3),c(t)};var c=function(n){var t=e.currenciesModel[n];for(var a in e.currenciesModel)e.currenciesModel[a]=i(l(n,a,t),2)};e.resetInputs=function(){for(var n in e.currenciesModel)e.currenciesModel[n]=null},e.show=function(){t.show({template:'<ion-spinner icon="dots" class="spinner-light"></ion-spinner>'})},e.hide=function(){t.hide()};var d=function(){e.show(t);var o=s.get("exchangeRates");if(o){var l=1e3*o.timestamp,i=864e5;if(Date.now()-l<i)return e.base=o.base,e.exchangeRates=o.rates,e.exchangeRateLastUpdated=new Date(l),void e.hide(t)}var u="https://data.fixer.io/api/latest?access_key=5b80344db7aec5d65deb6fedd17ca62e";n.get(u,{timeout:5e3}).then(function(n){var a=n.data;a.rates[a.base]=1,s.set("exchangeRates",a),e.base=a.base,e.exchangeRates=a.rates,e.exchangeRateLastUpdated=new Date(1e3*a.timestamp),e.hide(t)},function(s){n.get("backupRates.json").then(function(n){e.hide(t);var s=n.data;s.rates[s.base]=1,e.base=s.base,e.exchangeRates=s.rates,e.exchangeRateLastUpdated=new Date(1e3*s.timestamp);var o=e.exchangeRateLastUpdated.getFullYear(),l=e.exchangeRateLastUpdated.getMonth()+1;l<10&&(l="0"+l);var i=e.exchangeRateLastUpdated.getDate();a.alert({title:"Error",template:"Failed to get newest rates. Using rates from "+o+"-"+l+"-"+i+"."})})})},h=function(){var n=s.get("currenciesToShow");n&&(e.currencies=n)};e.updateCurrenciesToShow=function(){s.set("currenciesToShow",e.currencies)},d(),h(),o(),e.settingsMenuOpen=!1,document.getElementById("main-content-styles").addEventListener("click",function(){r()<767&&e.settingsMenuOpen&&e.toggleSettingsMenu()}),e.toggleSettingsMenu=function(){e.settingsMenuOpen?(document.getElementById("settings-side-menu").style.width="0",document.getElementById("main-content-styles").style.width="100%",document.getElementById("settings-icon").classList.remove("menu-open"),e.settingsMenuOpen=!1):(r()>767?(document.getElementById("settings-side-menu").style.width="330px",document.getElementById("main-content-styles").style.width="calc(100% - 330px)"):document.getElementById("settings-side-menu").style.width="300px",document.getElementById("settings-icon").classList.add("menu-open"),e.settingsMenuOpen=!0)}}]);